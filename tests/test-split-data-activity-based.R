## This file is part of coronet, which is free software: you
## can redistribute it and/or modify it under the terms of the GNU General
## Public License as published by  the Free Software Foundation, version 2.
##
## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License along
## with this program; if not, write to the Free Software Foundation, Inc.,
## 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
##
## Copyright 2017-2019 by Claus Hunsen <hunsen@fim.uni-passau.de>
## Copyright 2020 by Thomas Bock <bockthom@cs.uni-saarland.de>
## Copyright 2018 by Christian Hechtl <hechtl@fim.uni-passau.de>
## Copyright 2018 by Jakob Kronawitter <kronawij@fim.uni-passau.de>
## Copyright 2019 by Anselm Fehnker <fehnker@fim.uni-passau.de>
## Copyright 2021 by Niklas Schneider <s8nlschn@stud.uni-saarland.de>
## Copyright 2021 by Johannes Hostert <s8johost@stud.uni-saarland.de>
## Copyright 2022 by Jonathan Baumann <joba00002@stud.uni-saarland.de>
## Copyright 2023-2024 by Maximilian LÃ¶ffler <s8maloef@stud.uni-saarland.de>
## All Rights Reserved.

context("Splitting functionality, activity-based splitting of data.")

##
## Context
##

CF.DATA = file.path(".", "codeface-data")
CF.SELECTION.PROCESS = "testing"
CASESTUDY = "test"
ARTIFACT = "feature"

## use only when debugging this file independently
if (!dir.exists(CF.DATA)) CF.DATA = file.path(".", "tests", "codeface-data")


## / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / /
## Split data --------------------------------------------------------------

## * activity-based --------------------------------------------------------

## * * activity amount -----------------------------------------------------

##
## Tests for split.data.activity.based(..., activity.amount = ..., activity.type = 'commits')
##

patrick::with_parameters_test_that("Split a data object activity-based (activity.amount = ..., activity.type = 'commits').", {

    ## configuration objects
    proj.conf = ProjectConf$new(CF.DATA, CF.SELECTION.PROCESS, CASESTUDY, ARTIFACT)
    proj.conf$update.value("issues.from.source", c("jira", "github"))
    proj.conf$update.value("issues.only.comments", FALSE)
    proj.conf$update.values(list(pasta = test.pasta, synchronicity = test.synchronicity))
    net.conf = NetworkConf$new()

    ## data object
    project.data = ProjectData$new(proj.conf)
    data = list(
        commits = project.data$get.commits.unfiltered(),
        commit.messages = project.data$get.commit.messages(),
        issues = project.data$get.issues(),
        mails = project.data$get.mails(),
        pasta = project.data$get.pasta(),
        synchronicity = project.data$get.synchronicity()
    )

    ## split data
    results = split.data.activity.based(project.data, activity.amount = 3,
                                        activity.type = "commits", sliding.window = FALSE)

    ## check time ranges
    expected = c(
        "2016-07-12 15:58:59-2016-07-12 16:06:10",
        "2016-07-12 16:06:10-2016-07-12 16:06:32",
        "2016-07-12 16:06:32-2016-07-12 16:06:33"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected,
                     info = "Time ranges (activity.amount).")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2016-07-12 15:58:59", "2016-07-12 16:06:10", "2016-07-12 16:06:32", "2016-07-12 16:06:33")
    expected.config = list(
        split.type = "activity-based",
        split.length = 3,
        split.basis = "commits",
        split.sliding.window = FALSE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )

    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$commits[1:3, ],
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$commits[4:6, ],
            "2016-07-12 16:06:32-2016-07-12 16:06:33" = data$commits[7:8, ]
        ),
        commit.messages = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$commit.messages,
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$commit.messages,
            "2016-07-12 16:06:32-2016-07-12 16:06:33" = data$commit.messages
        ),
        issues = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$issues[rownames(data$issues) %in% c(1:3, 12, 21:25, 29:30, 32:34, 54:55), ],
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$issues[rownames(data$issues) == 4, ],
            "2016-07-12 16:06:32-2016-07-12 16:06:33" = data$issues[0, ]
        ),
        mails = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$mails[15:16, ], # when pasta is not configured: rownames(data$mails) %in% 16:17
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$mails[0, ],
            "2016-07-12 16:06:32-2016-07-12 16:06:33" = data$mails[0, ]
        ),
        pasta = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$pasta,
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$pasta,
            "2016-07-12 16:06:32-2016-07-12 16:06:33" = data$pasta
        ),
        synchronicity = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$synchronicity,
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$synchronicity,
            "2016-07-12 16:06:32-2016-07-12 16:06:33" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges (activity.amount).")

    ##
    ## split by too-large activity amount
    ##

    ## split data
    results = split.data.activity.based(project.data, activity.amount = nrow(data$commits) + 10,
                                        activity.type = "commits", sliding.window = FALSE)

    ## check time ranges
    expected = c(
        "2016-07-12 15:58:59-2016-07-12 16:06:33"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected,
                     info = "Time ranges (too-large activity amount).")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2016-07-12 15:58:59", "2016-07-12 16:06:33")
    expected.config = list(
        split.type = "activity-based",
        split.length = 18,
        split.basis = "commits",
        split.sliding.window = FALSE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:33" = data$commits
        ),
        commit.messages = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:33" = data$commit.messages
        ),
        issues = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:33" = data$issues[rownames(data$issues) %in% c(1:4, 12, 21:25, 29:30, 32:34, 54:55), ]
        ),
        mails = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:33" = data$mails[15:16, ] # when pasta is not configured: rownames(data$mails) %in% 16:17
        ),
        pasta = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:33" = data$pasta
        ),
        synchronicity = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:33" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges for too-large activity amount (activity.amount).")
}, patrick::cases(
    "pasta, synchronicity: FALSE" = list(test.pasta = FALSE, test.synchronicity = FALSE),
    "pasta, synchronicity: TRUE" = list(test.pasta = TRUE, test.synchronicity = TRUE)
))


##
## Tests for split.data.activity.based(..., activity.amount = ..., activity.type = 'mails')
##

patrick::with_parameters_test_that("Split a data object activity-based (activity.amount = ..., activity.type = 'mails').", {

    ## configuration objects
    proj.conf = ProjectConf$new(CF.DATA, CF.SELECTION.PROCESS, CASESTUDY, ARTIFACT)
    proj.conf$update.value("issues.from.source", c("jira", "github"))
    proj.conf$update.value("issues.only.comments", FALSE)
    proj.conf$update.values(list(pasta = test.pasta, synchronicity = test.synchronicity))
    net.conf = NetworkConf$new()

    ## data object
    project.data = ProjectData$new(proj.conf)
    data = list(
        commits = project.data$get.commits.unfiltered(),
        commit.messages = project.data$get.commit.messages(),
        issues = project.data$get.issues(),
        mails = project.data$get.mails(),
        pasta = project.data$get.pasta(),
        synchronicity = project.data$get.synchronicity()
    )

    ## split data
    results = split.data.activity.based(project.data, activity.amount = 3,
                                        activity.type = "mails", sliding.window = FALSE)

    ## check time ranges
    expected = c(
        "2004-10-09 18:38:13-2010-07-12 11:05:35",
        "2010-07-12 11:05:35-2010-07-12 12:05:41",
        "2010-07-12 12:05:41-2010-07-12 12:05:44",
        "2010-07-12 12:05:44-2016-07-12 15:58:40",
        "2016-07-12 15:58:40-2016-07-12 16:05:37",
        "2016-07-12 16:05:37-2016-07-12 16:05:38"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected, info = "Time ranges.")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2004-10-09 18:38:13", "2010-07-12 11:05:35", "2010-07-12 12:05:41",
                  "2010-07-12 12:05:44" ,"2016-07-12 15:58:40", "2016-07-12 16:05:37",
                  "2016-07-12 16:05:38")
    expected.config = list(
        split.type = "activity-based",
        split.length = 3,
        split.basis = "mails",
        split.sliding.window = FALSE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2004-10-09 18:38:13-2010-07-12 11:05:35" = data$commits[0, ],
            "2010-07-12 11:05:35-2010-07-12 12:05:41" = data$commits[0, ],
            "2010-07-12 12:05:41-2010-07-12 12:05:44" = data$commits[0, ],
            "2010-07-12 12:05:44-2016-07-12 15:58:40" = data$commits[0, ],
            "2016-07-12 15:58:40-2016-07-12 16:05:37" = data$commits[1:2, ],
            "2016-07-12 16:05:37-2016-07-12 16:05:38" = data$commits[0, ]
        ),
        commit.messages = list(
            "2004-10-09 18:38:13-2010-07-12 11:05:35" = data$commit.messages,
            "2010-07-12 11:05:35-2010-07-12 12:05:41" = data$commit.messages,
            "2010-07-12 12:05:41-2010-07-12 12:05:44" = data$commit.messages,
            "2010-07-12 12:05:44-2016-07-12 15:58:40" = data$commit.messages,
            "2016-07-12 15:58:40-2016-07-12 16:05:37" = data$commit.messages,
            "2016-07-12 16:05:37-2016-07-12 16:05:38" = data$commit.messages
        ),
        issues = list(
            "2004-10-09 18:38:13-2010-07-12 11:05:35" = data$issues[0, ],
            "2010-07-12 11:05:35-2010-07-12 12:05:41" = data$issues[0, ],
            "2010-07-12 12:05:41-2010-07-12 12:05:44" = data$issues[0, ],
            "2010-07-12 12:05:44-2016-07-12 15:58:40" = data$issues[rownames(data$issues) %in% c(10:11, 27:28, 37:49), ],
            "2016-07-12 15:58:40-2016-07-12 16:05:37" = data$issues[rownames(data$issues) %in% c(1:3, 12, 21:24, 29:30, 32:34, 54:55), ],
            "2016-07-12 16:05:37-2016-07-12 16:05:38" = data$issues[0, ]
        ),
        mails = list(
            ## comments indicate row names when pasta is not configured
            "2004-10-09 18:38:13-2010-07-12 11:05:35" = data$mails[1:3, ], # rownames(data$mails) %in% 1:3
            "2010-07-12 11:05:35-2010-07-12 12:05:41" = data$mails[4:6, ], # rownames(data$mails) %in% 4:6
            "2010-07-12 12:05:41-2010-07-12 12:05:44" = data$mails[7:9, ], # rownames(data$mails) %in% 7:9
            "2010-07-12 12:05:44-2016-07-12 15:58:40" = data$mails[10:12, ], # rownames(data$mails) %in% 10:12
            "2016-07-12 15:58:40-2016-07-12 16:05:37" = data$mails[13:15, ], # rownames(data$mails) %in% 14:16
            "2016-07-12 16:05:37-2016-07-12 16:05:38" = data$mails[16, ] # rownames(data$mails) %in% 17
        ),
        pasta = list(
            "2004-10-09 18:38:13-2010-07-12 11:05:35" = data$pasta,
            "2010-07-12 11:05:35-2010-07-12 12:05:41" = data$pasta,
            "2010-07-12 12:05:41-2010-07-12 12:05:44" = data$pasta,
            "2010-07-12 12:05:44-2016-07-12 15:58:40" = data$pasta,
            "2016-07-12 15:58:40-2016-07-12 16:05:37" = data$pasta,
            "2016-07-12 16:05:37-2016-07-12 16:05:38" = data$pasta
        ),
        synchronicity = list(
            "2004-10-09 18:38:13-2010-07-12 11:05:35" = data$synchronicity,
            "2010-07-12 11:05:35-2010-07-12 12:05:41" = data$synchronicity,
            "2010-07-12 12:05:41-2010-07-12 12:05:44" = data$synchronicity,
            "2010-07-12 12:05:44-2016-07-12 15:58:40" = data$synchronicity,
            "2016-07-12 15:58:40-2016-07-12 16:05:37" = data$synchronicity,
            "2016-07-12 16:05:37-2016-07-12 16:05:38" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges.")

    ##
    ## split by too-large activity amount
    ##

    ## split data
    results = split.data.activity.based(project.data, activity.amount = nrow(data$mails) + 10,
                                        activity.type = "mails", sliding.window = FALSE)

    ## check time ranges
    expected = c(
        "2004-10-09 18:38:13-2016-07-12 16:05:38"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected,
                     info = "Time ranges (too-large activity amount).")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2004-10-09 18:38:13", "2016-07-12 16:05:38")
    expected.config = list(
        split.type = "activity-based",
        split.length = 26,
        split.basis = "mails",
        split.sliding.window = FALSE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2004-10-09 18:38:13-2016-07-12 16:05:38" = data$commits[1:2, ]
        ),
        commit.messages = list(
            "2004-10-09 18:38:13-2016-07-12 16:05:38" = data$commit.messages
        ),
        issues = list(
            "2004-10-09 18:38:13-2016-07-12 16:05:38" = data$issues[rownames(data$issues) %in% c(1:3, 10:12, 21:24, 27:30, 32:34, 37:49, 54:55), ]
        ),
        mails = list(
            "2004-10-09 18:38:13-2016-07-12 16:05:38" = data$mails
        ),
        pasta = list(
            "2004-10-09 18:38:13-2016-07-12 16:05:38" = data$pasta
        ),
        synchronicity = list(
            "2004-10-09 18:38:13-2016-07-12 16:05:38" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges (too-large activity amount).")
}, patrick::cases(
    "pasta, synchronicity: FALSE" = list(test.pasta = FALSE, test.synchronicity = FALSE),
    "pasta, synchronicity: TRUE" = list(test.pasta = TRUE, test.synchronicity = TRUE)
))


##
## Tests for split.data.activity.based(..., activity.amount = ..., activity.type = 'issues')
##

patrick::with_parameters_test_that("Split a data object activity-based (activity.amount = ..., activity.type = 'issues').", {

    ## configuration objects
    proj.conf = ProjectConf$new(CF.DATA, CF.SELECTION.PROCESS, CASESTUDY, ARTIFACT)
    proj.conf$update.value("issues.from.source", c("jira", "github"))
    proj.conf$update.value("issues.only.comments", FALSE)
    proj.conf$update.values(list(pasta = test.pasta, synchronicity = test.synchronicity))
    net.conf = NetworkConf$new()

    ## data object
    project.data = ProjectData$new(proj.conf)
    data = list(
        commits = project.data$get.commits.unfiltered(),
        commit.messages = project.data$get.commit.messages(),
        issues = project.data$get.issues(),
        mails = project.data$get.mails(),
        pasta = project.data$get.pasta(),
        synchronicity = project.data$get.synchronicity()
    )

    ## split data
    results = split.data.activity.based(project.data, activity.amount = 9,
                                        activity.type = "issues", sliding.window = FALSE)

    ## check time ranges
    expected = c(
        "2013-04-21 23:52:09-2013-05-25 06:22:23",
        "2013-05-25 06:22:23-2016-07-12 15:59:59",
        "2016-07-12 15:59:59-2016-07-12 16:06:30",
        "2016-07-12 16:06:30-2016-08-07 15:37:02",
        "2016-08-07 15:37:02-2017-05-23 12:31:34",
        "2017-05-23 12:31:34-2017-05-23 12:32:40"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected, info = "Time ranges.")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2013-04-21 23:52:09", "2013-05-25 06:22:23", "2016-07-12 15:59:59",
                  "2016-07-12 16:06:30", "2016-08-07 15:37:02", "2017-05-23 12:31:34",
                  "2017-05-23 12:32:40")
    expected.config = list(
        split.type = "activity-based",
        split.length = 9,
        split.basis = "issues",
        split.sliding.window = FALSE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2013-04-21 23:52:09-2013-05-25 06:22:23" = data$commits[0, ],
            "2013-05-25 06:22:23-2016-07-12 15:59:59" = data$commits[1, ],
            "2016-07-12 15:59:59-2016-07-12 16:06:30" = data$commits[2:5, ],
            "2016-07-12 16:06:30-2016-08-07 15:37:02" = data$commits[6:8, ],
            "2016-08-07 15:37:02-2017-05-23 12:31:34" = data$commits[0, ],
            "2017-05-23 12:31:34-2017-05-23 12:32:40" = data$commits[0, ]
        ),
        commit.messages = list(
            "2013-04-21 23:52:09-2013-05-25 06:22:23" = data$commit.messages,
            "2013-05-25 06:22:23-2016-07-12 15:59:59" = data$commit.messages,
            "2016-07-12 15:59:59-2016-07-12 16:06:30" = data$commit.messages,
            "2016-07-12 16:06:30-2016-08-07 15:37:02" = data$commit.messages,
            "2016-08-07 15:37:02-2017-05-23 12:31:34" = data$commit.messages,
            "2017-05-23 12:31:34-2017-05-23 12:32:40" = data$commit.messages
        ),
        issues = list(
            "2013-04-21 23:52:09-2013-05-25 06:22:23" = data$issues[rownames(data$issues) %in% 37:46, ],
            "2013-05-25 06:22:23-2016-07-12 15:59:59" = data$issues[rownames(data$issues) %in% c(1:3, 10:11, 21:22, 27:28, 47:49), ],
            "2016-07-12 15:59:59-2016-07-12 16:06:30" = data$issues[rownames(data$issues) %in% c(12, 23:25, 29:30, 32:34, 54:55), ],
            "2016-07-12 16:06:30-2016-08-07 15:37:02" = data$issues[rownames(data$issues) %in% c(4:5, 8:9, 26, 31, 56:59), ],
            "2016-08-07 15:37:02-2017-05-23 12:31:34" = data$issues[rownames(data$issues) %in% c(6:7, 13:17, 20, 50:53), ],
            "2017-05-23 12:31:34-2017-05-23 12:32:40" = data$issues[rownames(data$issues) %in% c(18:19), ]
        ),
        mails = list(
            ## comments indicate row names when pasta is not configured
            "2013-04-21 23:52:09-2013-05-25 06:22:23" = data$mails[0, ],
            "2013-05-25 06:22:23-2016-07-12 15:59:59" = data$mails[13:14, ], # rownames(data$mails) %in% 13:14
            "2016-07-12 15:59:59-2016-07-12 16:06:30" = data$mails[15:16, ], # rownames(data$mails) %in% 15:16
            "2016-07-12 16:06:30-2016-08-07 15:37:02" = data$mails[0, ],
            "2016-08-07 15:37:02-2017-05-23 12:31:34" = data$mails[0, ],
            "2017-05-23 12:31:34-2017-05-23 12:32:40" = data$mails[0, ]
        ),
        pasta = list(
            "2013-04-21 23:52:09-2013-05-25 06:22:23" = data$pasta,
            "2013-05-25 06:22:23-2016-07-12 15:59:59" = data$pasta,
            "2016-07-12 15:59:59-2016-07-12 16:06:30" = data$pasta,
            "2016-07-12 16:06:30-2016-08-07 15:37:02" = data$pasta,
            "2016-08-07 15:37:02-2017-05-23 12:31:34" = data$pasta,
            "2017-05-23 12:31:34-2017-05-23 12:32:40" = data$pasta
        ),
        synchronicity = list(
            "2013-04-21 23:52:09-2013-05-25 06:22:23" = data$synchronicity,
            "2013-05-25 06:22:23-2016-07-12 15:59:59" = data$synchronicity,
            "2016-07-12 15:59:59-2016-07-12 16:06:30" = data$synchronicity,
            "2016-07-12 16:06:30-2016-08-07 15:37:02" = data$synchronicity,
            "2016-08-07 15:37:02-2017-05-23 12:31:34" = data$synchronicity,
            "2017-05-23 12:31:34-2017-05-23 12:32:40" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges.")

    ##
    ## split by too-large activity amount
    ##

    ## split data
    results = split.data.activity.based(project.data, activity.amount = nrow(data$issues) + 10,
                                        activity.type = "issues", sliding.window = FALSE)

    ## check time ranges
    expected = c(
        "2013-04-21 23:52:09-2017-05-23 12:32:40"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected,
                     info = "Time ranges (too-large activity amount).")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2013-04-21 23:52:09", "2017-05-23 12:32:40")
    expected.config = list(
        split.type = "activity-based",
        split.length = 67,
        split.basis = "issues",
        split.sliding.window = FALSE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2013-04-21 23:52:09-2017-05-23 12:32:40" = data$commits
        ),
        commit.messages = list(
            "2013-04-21 23:52:09-2017-05-23 12:32:40" = data$commit.messages
        ),
        issues = list(
            "2013-04-21 23:52:09-2017-05-23 12:32:40" = data$issues
        ),
        mails = list(
            "2013-04-21 23:52:09-2017-05-23 12:32:40" = data$mails[13:16, ] # when pasta is not configured: rownames(data$mails) %in% 14:17
        ),
        pasta = list(
            "2013-04-21 23:52:09-2017-05-23 12:32:40" = data$pasta
        ),
        synchronicity = list(
            "2013-04-21 23:52:09-2017-05-23 12:32:40" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges (too-large activity amount).")
}, patrick::cases(
    "pasta, synchronicity: FALSE" = list(test.pasta = FALSE, test.synchronicity = FALSE),
    "pasta, synchronicity: TRUE" = list(test.pasta = TRUE, test.synchronicity = TRUE)
))


## * * activity amount, sliding windows ------------------------------------
##
## Tests for split.data.activity.based(..., activity.type = 'commits') using sliding windows
##

patrick::with_parameters_test_that("Split a data object activity-based (activity.type = 'commits', sliding.window = TRUE).", {

    ## configuration objects
    proj.conf = ProjectConf$new(CF.DATA, CF.SELECTION.PROCESS, CASESTUDY, ARTIFACT)
    proj.conf$update.value("issues.from.source", c("jira", "github"))
    proj.conf$update.value("issues.only.comments", FALSE)
    proj.conf$update.values(list(pasta = test.pasta, synchronicity = test.synchronicity))
    net.conf = NetworkConf$new()

    ## data object
    project.data = ProjectData$new(proj.conf)
    data = list(
        commits = project.data$get.commits.unfiltered(),
        commit.messages = project.data$get.commit.messages(),
        issues = project.data$get.issues(),
        mails = project.data$get.mails(),
        pasta = project.data$get.pasta(),
        synchronicity = project.data$get.synchronicity()
    )

    ## split data
    results = split.data.activity.based(project.data, activity.amount = 3,
                                        activity.type = "commits", sliding.window = TRUE)

    ## check time ranges
    expected = c(
        "2016-07-12 15:58:59-2016-07-12 16:06:10",
        "2016-07-12 16:00:45-2016-07-12 16:06:20",
        "2016-07-12 16:06:10-2016-07-12 16:06:32",
        "2016-07-12 16:06:20-2016-07-12 16:06:33"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected,
                     info = "Time ranges (activity.amount).")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2016-07-12 15:58:59", "2016-07-12 16:00:45", "2016-07-12 16:06:10",
                  "2016-07-12 16:06:20", "2016-07-12 16:06:32", "2016-07-12 16:06:33")
    expected.config = list(
        split.type = "activity-based",
        split.length = 3,
        split.basis = "commits",
        split.sliding.window = TRUE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$commits[1:3, ],
            "2016-07-12 16:00:45-2016-07-12 16:06:20" = data$commits[2:4, ],
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$commits[4:6, ],
            "2016-07-12 16:06:20-2016-07-12 16:06:33" = data$commits[5:8, ]
        ),
        commit.messages = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$commit.messages,
            "2016-07-12 16:00:45-2016-07-12 16:06:20" = data$commit.messages,
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$commit.messages,
            "2016-07-12 16:06:20-2016-07-12 16:06:33" = data$commit.messages
        ),
        issues = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$issues[rownames(data$issues) %in% c(1:3, 12, 21:25, 29:30, 32:34, 54:55), ],
            "2016-07-12 16:00:45-2016-07-12 16:06:20" = data$issues[rownames(data$issues) %in% c(12, 24:25, 29:30, 32:34, 54:55), ],
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$issues[rownames(data$issues) == 4, ],
            "2016-07-12 16:06:20-2016-07-12 16:06:33" = data$issues[rownames(data$issues) == 4, ]
        ),
        mails = list(
            ## comments indicate row names when pasta is not configured
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$mails[15:16, ], # rownames(data$mails) %in% 16:17
            "2016-07-12 16:00:45-2016-07-12 16:06:20" = data$mails[15:16, ], # rownames(data$mails) %in% 16:17
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$mails[0, ],
            "2016-07-12 16:06:20-2016-07-12 16:06:33" = data$mails[0, ]
        ),
        pasta = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$pasta,
            "2016-07-12 16:00:45-2016-07-12 16:06:20" = data$pasta,
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$pasta,
            "2016-07-12 16:06:20-2016-07-12 16:06:33" = data$pasta
        ),
        synchronicity = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$synchronicity,
            "2016-07-12 16:00:45-2016-07-12 16:06:20" = data$synchronicity,
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$synchronicity,
            "2016-07-12 16:06:20-2016-07-12 16:06:33" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges (activity.amount).")

    ##
    ## split by too-large activity amount
    ##

    ## split data
    results = split.data.activity.based(project.data, activity.amount = nrow(data$commits) + 10,
                                        activity.type = "commits", sliding.window = TRUE)

    ## check time ranges
    expected = c(
        "2016-07-12 15:58:59-2016-07-12 16:06:33"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected,
                     info = "Time ranges (too-large activity amount).")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2016-07-12 15:58:59", "2016-07-12 16:06:33")
    expected.config = list(
        split.type = "activity-based",
        split.length = 18,
        split.basis = "commits",
        split.sliding.window = FALSE, # The sliding-window approach does not apply if we only have one range or less
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:33" = data$commits
        ),
        commit.messages = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:33" = data$commit.messages
        ),
        issues = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:33" = data$issues[rownames(data$issues) %in% c(1:4, 12, 21:25, 29:30, 32:34, 54:55), ]
        ),
        mails = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:33" = data$mails[15:16, ] # when pasta is not configured: rownames(data$mails) %in% 16:17
        ),
        pasta = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:33" = data$pasta
        ),
        synchronicity = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:33" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges for too-large activity amount (activity.amount).")
}, patrick::cases(
    "pasta, synchronicity: FALSE" = list(test.pasta = FALSE, test.synchronicity = FALSE),
    "pasta, synchronicity: TRUE" = list(test.pasta = TRUE, test.synchronicity = TRUE)
))

patrick::with_parameters_test_that("Split a data object activity-based (activity.type = 'commits', sliding.window = TRUE), continued.", {

    ## configuration objects
    proj.conf = ProjectConf$new(CF.DATA, CF.SELECTION.PROCESS, CASESTUDY, ARTIFACT)
    proj.conf$update.value("issues.from.source", c("jira", "github"))
    proj.conf$update.value("issues.only.comments", FALSE)
    proj.conf$update.values(list(pasta = test.pasta, synchronicity = test.synchronicity))
    net.conf = NetworkConf$new()

    ## data object
    project.data = ProjectData$new(proj.conf)

    ## add one commit to the commit data having same date as latest commit
    commit.data = project.data$get.commits.unfiltered()
    latest.commit = commit.data[nrow(commit.data), ]
    latest.commit[1, "commit.id"] = "<commit-added>"
    latest.commit[1, "hash"] = "abcdefghijklmnopqrstuvxyz"
    commit.data = rbind(commit.data, latest.commit)
    project.data$set.commits(commit.data)

    data = list(
        commits = project.data$get.commits.unfiltered(),
        commit.messages = project.data$get.commit.messages(),
        issues = project.data$get.issues(),
        mails = project.data$get.mails(),
        pasta = project.data$get.pasta(),
        synchronicity = project.data$get.synchronicity()
    )

    ## split data
    results = split.data.activity.based(project.data, activity.amount = 3,
                                        activity.type = "commits", sliding.window = TRUE)

    ## check time ranges
    expected = c(
        "2016-07-12 15:58:59-2016-07-12 16:06:10",
        "2016-07-12 16:00:45-2016-07-12 16:06:20",
        "2016-07-12 16:06:10-2016-07-12 16:06:32",
        "2016-07-12 16:06:20-2016-07-12 16:06:32",
        "2016-07-12 16:06:32-2016-07-12 16:06:33"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected,
                     info = "Time ranges (activity.amount).")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2016-07-12 15:58:59", "2016-07-12 16:00:45", "2016-07-12 16:06:10",
                  "2016-07-12 16:06:20", "2016-07-12 16:06:32", "2016-07-12 16:06:32",
                  "2016-07-12 16:06:33")
    expected.config = list(
        split.type = "activity-based",
        split.length = 3,
        split.basis = "commits",
        split.sliding.window = TRUE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$commits[1:3, ],
            "2016-07-12 16:00:45-2016-07-12 16:06:20" = data$commits[2:4, ],
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$commits[4:6, ],
            "2016-07-12 16:06:20-2016-07-12 16:06:32" = data$commits[5:8, ],
            "2016-07-12 16:06:32-2016-07-12 16:06:33" = data$commits[7:9, ]
        ),
        commit.messages = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$commit.messages,
            "2016-07-12 16:00:45-2016-07-12 16:06:20" = data$commit.messages,
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$commit.messages,
            "2016-07-12 16:06:20-2016-07-12 16:06:32" = data$commit.messages,
            "2016-07-12 16:06:32-2016-07-12 16:06:33" = data$commit.messages
        ),
        issues = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$issues[rownames(data$issues) %in% c(1:3, 12, 21:25, 29:30, 32:34, 54:55), ],
            "2016-07-12 16:00:45-2016-07-12 16:06:20" = data$issues[rownames(data$issues) %in% c(12, 24:25, 29:30, 32:34, 54:55), ],
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$issues[rownames(data$issues) == 4, ],
            "2016-07-12 16:06:20-2016-07-12 16:06:32" = data$issues[rownames(data$issues) == 4, ],
            "2016-07-12 16:06:32-2016-07-12 16:06:33" = data$issues[0, ]
        ),
        mails = list(
            ## comments indicate row names when pasta is not configured
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$mails[15:16, ], # rownames(data$mails) %in% 16:17
            "2016-07-12 16:00:45-2016-07-12 16:06:20" = data$mails[15:16, ], # rownames(data$mails) %in% 16:17
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$mails[0, ],
            "2016-07-12 16:06:20-2016-07-12 16:06:32" = data$mails[0, ],
            "2016-07-12 16:06:32-2016-07-12 16:06:33" = data$mails[0, ]
        ),
        pasta = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$pasta,
            "2016-07-12 16:00:45-2016-07-12 16:06:20" = data$pasta,
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$pasta,
            "2016-07-12 16:06:20-2016-07-12 16:06:32" = data$pasta,
            "2016-07-12 16:06:32-2016-07-12 16:06:33" = data$pasta
        ),
        synchronicity = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:10" = data$synchronicity,
            "2016-07-12 16:00:45-2016-07-12 16:06:20" = data$synchronicity,
            "2016-07-12 16:06:10-2016-07-12 16:06:32" = data$synchronicity,
            "2016-07-12 16:06:20-2016-07-12 16:06:32" = data$synchronicity,
            "2016-07-12 16:06:32-2016-07-12 16:06:33" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges (activity.amount).")

}, patrick::cases(
    "pasta, synchronicity: FALSE" = list(test.pasta = FALSE, test.synchronicity = FALSE),
    "pasta, synchronicity: TRUE" = list(test.pasta = TRUE, test.synchronicity = TRUE)
))


##
## Tests for split.data.activity.based(..., activity.type = 'mails') using sliding windows
##

patrick::with_parameters_test_that("Split a data object activity-based (activity.type = 'mails', sliding.window = TRUE).", {

    ## configuration objects
    proj.conf = ProjectConf$new(CF.DATA, CF.SELECTION.PROCESS, CASESTUDY, ARTIFACT)
    proj.conf$update.value("issues.from.source", c("jira", "github"))
    proj.conf$update.value("issues.only.comments", FALSE)
    proj.conf$update.values(list(pasta = test.pasta, synchronicity = test.synchronicity))
    net.conf = NetworkConf$new()

    ## data object
    project.data = ProjectData$new(proj.conf)
    data = list(
        commits = project.data$get.commits.unfiltered(),
        commit.messages = project.data$get.commit.messages(),
        issues = project.data$get.issues(),
        mails = project.data$get.mails(),
        pasta = project.data$get.pasta(),
        synchronicity = project.data$get.synchronicity()
    )

    ## split data
    results = split.data.activity.based(project.data, activity.amount = 3,
                                        activity.type = "mails", sliding.window = TRUE)

    ## check time ranges
    expected = c(
        "2004-10-09 18:38:13-2010-07-12 11:05:35",
        "2005-02-09 18:49:49-2010-07-12 12:05:34",
        "2010-07-12 11:05:35-2010-07-12 12:05:41",
        "2010-07-12 12:05:34-2010-07-12 12:05:42",
        "2010-07-12 12:05:41-2010-07-12 12:05:44",
        "2010-07-12 12:05:42-2010-07-12 12:05:45",
        "2010-07-12 12:05:44-2016-07-12 15:58:40",
        "2010-07-12 12:05:45-2016-07-12 15:58:50",
        "2016-07-12 15:58:40-2016-07-12 16:05:37",
        "2016-07-12 15:58:50-2016-07-12 16:05:38"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected, info = "Time ranges.")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2004-10-09 18:38:13", "2005-02-09 18:49:49", "2010-07-12 11:05:35",
                  "2010-07-12 12:05:34", "2010-07-12 12:05:41", "2010-07-12 12:05:42",
                  "2010-07-12 12:05:44", "2010-07-12 12:05:45", "2016-07-12 15:58:40",
                  "2016-07-12 15:58:50", "2016-07-12 16:05:37", "2016-07-12 16:05:38")
    expected.config = list(
        split.type = "activity-based",
        split.length = 3,
        split.basis = "mails",
        split.sliding.window = TRUE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2004-10-09 18:38:13-2010-07-12 11:05:35" = data$commits[0, ],
            "2005-02-09 18:49:49-2010-07-12 12:05:34" = data$commits[0, ],
            "2010-07-12 11:05:35-2010-07-12 12:05:41" = data$commits[0, ],
            "2010-07-12 12:05:34-2010-07-12 12:05:42" = data$commits[0, ],
            "2010-07-12 12:05:41-2010-07-12 12:05:44" = data$commits[0, ],
            "2010-07-12 12:05:42-2010-07-12 12:05:45" = data$commits[0, ],
            "2010-07-12 12:05:44-2016-07-12 15:58:40" = data$commits[0, ],
            "2010-07-12 12:05:45-2016-07-12 15:58:50" = data$commits[0, ],
            "2016-07-12 15:58:40-2016-07-12 16:05:37" = data$commits[1:2, ],
            "2016-07-12 15:58:50-2016-07-12 16:05:38" = data$commits[1:2, ]
        ),
        commit.messages = list(
            "2004-10-09 18:38:13-2010-07-12 11:05:35" = data$commit.messages,
            "2005-02-09 18:49:49-2010-07-12 12:05:34" = data$commit.messages,
            "2010-07-12 11:05:35-2010-07-12 12:05:41" = data$commit.messages,
            "2010-07-12 12:05:34-2010-07-12 12:05:42" = data$commit.messages,
            "2010-07-12 12:05:41-2010-07-12 12:05:44" = data$commit.messages,
            "2010-07-12 12:05:42-2010-07-12 12:05:45" = data$commit.messages,
            "2010-07-12 12:05:44-2016-07-12 15:58:40" = data$commit.messages,
            "2010-07-12 12:05:45-2016-07-12 15:58:50" = data$commit.messages,
            "2016-07-12 15:58:40-2016-07-12 16:05:37" = data$commit.messages,
            "2016-07-12 15:58:50-2016-07-12 16:05:38" = data$commit.messages
        ),
        issues = list(
            "2004-10-09 18:38:13-2010-07-12 11:05:35" = data$issues[0, ],
            "2005-02-09 18:49:49-2010-07-12 12:05:34" = data$issues[0, ],
            "2010-07-12 11:05:35-2010-07-12 12:05:41" = data$issues[0, ],
            "2010-07-12 12:05:34-2010-07-12 12:05:42" = data$issues[0, ],
            "2010-07-12 12:05:41-2010-07-12 12:05:44" = data$issues[0, ],
            "2010-07-12 12:05:42-2010-07-12 12:05:45" = data$issues[0, ],
            "2010-07-12 12:05:44-2016-07-12 15:58:40" = data$issues[rownames(data$issues) %in% c(10:11, 27:28, 37:49), ],
            "2010-07-12 12:05:45-2016-07-12 15:58:50" = data$issues[rownames(data$issues) %in% c(10:11, 27:28, 37:49), ],
            "2016-07-12 15:58:40-2016-07-12 16:05:37" = data$issues[rownames(data$issues) %in% c(1:3, 12, 21:24, 29:30, 32:34, 54:55), ],
            "2016-07-12 15:58:50-2016-07-12 16:05:38" = data$issues[rownames(data$issues) %in% c(1:3, 12, 21:24, 29:30, 32:34, 54:55), ]
        ),
        mails = list(
            ## comments indicate row names when pasta is not configured
            "2004-10-09 18:38:13-2010-07-12 11:05:35" = data$mails[1:3, ], # rownames(data$mails) %in% 1:3
            "2005-02-09 18:49:49-2010-07-12 12:05:34" = data$mails[2:4, ], # rownames(data$mails) %in% 2:4
            "2010-07-12 11:05:35-2010-07-12 12:05:41" = data$mails[4:6, ], # rownames(data$mails) %in% 4:6
            "2010-07-12 12:05:34-2010-07-12 12:05:42" = data$mails[5:7, ], # rownames(data$mails) %in% 5:7
            "2010-07-12 12:05:41-2010-07-12 12:05:44" = data$mails[7:9, ], # rownames(data$mails) %in% 7:9
            "2010-07-12 12:05:42-2010-07-12 12:05:45" = data$mails[8:10, ], # rownames(data$mails) %in% 8:10
            "2010-07-12 12:05:44-2016-07-12 15:58:40" = data$mails[10:12, ], # rownames(data$mails) %in% 10:12
            "2010-07-12 12:05:45-2016-07-12 15:58:50" = data$mails[11:13, ], # rownames(data$mails) %in% c(11:12, 14)
            "2016-07-12 15:58:40-2016-07-12 16:05:37" = data$mails[13:15, ], # rownames(data$mails) %in% 14:16
            "2016-07-12 15:58:50-2016-07-12 16:05:38" = data$mails[14:16, ] # rownames(data$mails) %in% 15:17
        ),
        pasta = list(
            "2004-10-09 18:38:13-2010-07-12 11:05:35" = data$pasta,
            "2005-02-09 18:49:49-2010-07-12 12:05:34" = data$pasta,
            "2010-07-12 11:05:35-2010-07-12 12:05:41" = data$pasta,
            "2010-07-12 12:05:34-2010-07-12 12:05:42" = data$pasta,
            "2010-07-12 12:05:41-2010-07-12 12:05:44" = data$pasta,
            "2010-07-12 12:05:42-2010-07-12 12:05:45" = data$pasta,
            "2010-07-12 12:05:44-2016-07-12 15:58:40" = data$pasta,
            "2010-07-12 12:05:45-2016-07-12 15:58:50" = data$pasta,
            "2016-07-12 15:58:40-2016-07-12 16:05:37" = data$pasta,
            "2016-07-12 15:58:50-2016-07-12 16:05:38" = data$pasta
        ),
        synchronicity = list(
            "2004-10-09 18:38:13-2010-07-12 11:05:35" = data$synchronicity,
            "2005-02-09 18:49:49-2010-07-12 12:05:34" = data$synchronicity,
            "2010-07-12 11:05:35-2010-07-12 12:05:41" = data$synchronicity,
            "2010-07-12 12:05:34-2010-07-12 12:05:42" = data$synchronicity,
            "2010-07-12 12:05:41-2010-07-12 12:05:44" = data$synchronicity,
            "2010-07-12 12:05:42-2010-07-12 12:05:45" = data$synchronicity,
            "2010-07-12 12:05:44-2016-07-12 15:58:40" = data$synchronicity,
            "2010-07-12 12:05:45-2016-07-12 15:58:50" = data$synchronicity,
            "2016-07-12 15:58:40-2016-07-12 16:05:37" = data$synchronicity,
            "2016-07-12 15:58:50-2016-07-12 16:05:38" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges.")

    ##
    ## split by too-large activity amount
    ##

    ## split data
    results = split.data.activity.based(project.data, activity.amount = nrow(data$mails) + 10,
                                        activity.type = "mails", sliding.window = TRUE)

    ## check time ranges
    expected = c(
        "2004-10-09 18:38:13-2016-07-12 16:05:38"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected,
                     info = "Time ranges (too-large activity amount).")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2004-10-09 18:38:13", "2016-07-12 16:05:38")
    expected.config = list(
        split.type = "activity-based",
        split.length = 26,
        split.basis = "mails",
        split.sliding.window = FALSE, # The sliding-window approach does not apply if we only have one range or less
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)            
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2004-10-09 18:38:13-2016-07-12 16:05:38" = data$commits[1:2, ]
        ),
        commit.messages = list(
            "2004-10-09 18:38:13-2016-07-12 16:05:38" = data$commit.messages
        ),
        issues = list(
            "2004-10-09 18:38:13-2016-07-12 16:05:38" = data$issues[rownames(data$issues) %in% c(1:3, 10:12, 21:24, 27:30, 32:34, 37:49, 54:55), ]
        ),
        mails = list(
            "2004-10-09 18:38:13-2016-07-12 16:05:38" = data$mails
        ),
        pasta = list(
            "2004-10-09 18:38:13-2016-07-12 16:05:38" = data$pasta
        ),
        synchronicity = list(
            "2004-10-09 18:38:13-2016-07-12 16:05:38" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges (too-large activity amount).")
}, patrick::cases(
    "pasta, synchronicity: FALSE" = list(test.pasta = FALSE, test.synchronicity = FALSE),
    "pasta, synchronicity: TRUE" = list(test.pasta = TRUE, test.synchronicity = TRUE)
))


##
## Tests for split.data.activity.based(..., activity.type = 'issues') using sliding windows
##

patrick::with_parameters_test_that("Split a data object activity-based (activity.type = 'issues', sliding.window = TRUE).", {

    ## configuration objects
    proj.conf = ProjectConf$new(CF.DATA, CF.SELECTION.PROCESS, CASESTUDY, ARTIFACT)
    proj.conf$update.value("issues.from.source", c("jira", "github"))
    proj.conf$update.value("issues.only.comments", FALSE)
    proj.conf$update.values(list(pasta = test.pasta, synchronicity = test.synchronicity))
    net.conf = NetworkConf$new()

    ## data object
    project.data = ProjectData$new(proj.conf)
    data = list(
        commits = project.data$get.commits.unfiltered(),
        commit.messages = project.data$get.commit.messages(),
        issues = project.data$get.issues(),
        mails = project.data$get.mails(),
        pasta = project.data$get.pasta(),
        synchronicity = project.data$get.synchronicity()
    )

    ## split data
    results = split.data.activity.based(project.data, activity.amount = 9,
                                        activity.type = "issues", sliding.window = TRUE)

    ## check time ranges
    expected = c(
        "2013-04-21 23:52:09-2013-05-25 06:22:23",
        "2013-05-06 01:04:34-2016-07-12 15:30:02",
        "2013-05-25 06:22:23-2016-07-12 15:59:59",
        "2016-07-12 15:30:02-2016-07-12 16:02:02",
        "2016-07-12 15:59:59-2016-07-12 16:06:30",
        "2016-07-12 16:02:02-2016-07-27 20:12:08",
        "2016-07-12 16:06:30-2016-08-07 15:37:02",
        "2016-07-27 20:12:08-2016-10-05 16:45:09",
        "2016-08-07 15:37:02-2017-05-23 12:31:34",
        "2016-10-05 16:45:09-2017-05-23 12:32:40"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected, info = "Time ranges.")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2013-04-21 23:52:09", "2013-05-06 01:04:34", "2013-05-25 06:22:23",
                  "2016-07-12 15:30:02", "2016-07-12 15:59:59", "2016-07-12 16:02:02",
                  "2016-07-12 16:06:30", "2016-07-27 20:12:08", "2016-08-07 15:37:02",
                  "2016-10-05 16:45:09", "2017-05-23 12:31:34", "2017-05-23 12:32:40")
    expected.config = list(
        split.type = "activity-based",
        split.length = 9,
        split.basis = "issues",
        split.sliding.window = TRUE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2013-04-21 23:52:09-2013-05-25 06:22:23" = data$commits[0, ],
            "2013-05-06 01:04:34-2016-07-12 15:30:02" = data$commits[0, ],
            "2013-05-25 06:22:23-2016-07-12 15:59:59" = data$commits[1, ],
            "2016-07-12 15:30:02-2016-07-12 16:02:02" = data$commits[1:2, ],
            "2016-07-12 15:59:59-2016-07-12 16:06:30" = data$commits[2:5, ],
            "2016-07-12 16:02:02-2016-07-27 20:12:08" = data$commits[3:8, ],
            "2016-07-12 16:06:30-2016-08-07 15:37:02" = data$commits[6:8, ],
            "2016-07-27 20:12:08-2016-10-05 16:45:09" = data$commits[0, ],
            "2016-08-07 15:37:02-2017-05-23 12:31:34" = data$commits[0, ],
            "2016-10-05 16:45:09-2017-05-23 12:32:40" = data$commits[0, ]
        ),
        commit.messages = list(
            "2013-04-21 23:52:09-2013-05-25 06:22:23" = data$commit.messages,
            "2013-05-06 01:04:34-2016-07-12 15:30:02" = data$commit.messages,
            "2013-05-25 06:22:23-2016-07-12 15:59:59" = data$commit.messages,
            "2016-07-12 15:30:02-2016-07-12 16:02:02" = data$commit.messages,
            "2016-07-12 15:59:59-2016-07-12 16:06:30" = data$commit.messages,
            "2016-07-12 16:02:02-2016-07-27 20:12:08" = data$commit.messages,
            "2016-07-12 16:06:30-2016-08-07 15:37:02" = data$commit.messages,
            "2016-07-27 20:12:08-2016-10-05 16:45:09" = data$commit.messages,
            "2016-08-07 15:37:02-2017-05-23 12:31:34" = data$commit.messages,
            "2016-10-05 16:45:09-2017-05-23 12:32:40" = data$commit.messages
        ),
        issues = list(
            "2013-04-21 23:52:09-2013-05-25 06:22:23" = data$issues[rownames(data$issues) %in% 37:46, ],
            "2013-05-06 01:04:34-2016-07-12 15:30:02" = data$issues[rownames(data$issues) %in% c(27:28, 42:49), ],
            "2013-05-25 06:22:23-2016-07-12 15:59:59" = data$issues[rownames(data$issues) %in% c(1:3, 10:11, 21:22, 27:28, 47:49), ],
            "2016-07-12 15:30:02-2016-07-12 16:02:02" = data$issues[rownames(data$issues) %in% c(1:3, 10:11, 21:24, 32, 54), ],
            "2016-07-12 15:59:59-2016-07-12 16:06:30" = data$issues[rownames(data$issues) %in% c(12, 23:25, 29:30, 32:34, 54:55), ],
            "2016-07-12 16:02:02-2016-07-27 20:12:08" = data$issues[rownames(data$issues) %in% c(4, 12, 25:26, 29:30, 33:34, 55:57), ],
            "2016-07-12 16:06:30-2016-08-07 15:37:02" = data$issues[rownames(data$issues) %in% c(4:5, 8:9, 26, 31, 56:59), ],
            "2016-07-27 20:12:08-2016-10-05 16:45:09" = data$issues[rownames(data$issues) %in% c(5:6, 8:9, 13:14, 20, 31, 58:59), ],
            "2016-08-07 15:37:02-2017-05-23 12:31:34" = data$issues[rownames(data$issues) %in% c(6:7, 13:17, 20, 50:53), ],
            "2016-10-05 16:45:09-2017-05-23 12:32:40" = data$issues[rownames(data$issues) %in% c(7, 15:19, 50:53), ]
        ),
        mails = list(
            ## comments indicate row names when pasta is not configured
            "2013-04-21 23:52:09-2013-05-25 06:22:23" = data$mails[0, ],
            "2013-05-06 01:04:34-2016-07-12 15:30:02" = data$mails[0, ],
            "2013-05-25 06:22:23-2016-07-12 15:59:59" = data$mails[13:14, ], # rownames(data$mails) %in% 13:14
            "2016-07-12 15:30:02-2016-07-12 16:02:02" = data$mails[13:14, ], # rownames(data$mails) %in% 13:14
            "2016-07-12 15:59:59-2016-07-12 16:06:30" = data$mails[15:16, ], # rownames(data$mails) %in% 15:16
            "2016-07-12 16:02:02-2016-07-27 20:12:08" = data$mails[15:16, ], # rownames(data$mails) %in% 15:16
            "2016-07-12 16:06:30-2016-08-07 15:37:02" = data$mails[0, ],
            "2016-07-27 20:12:08-2016-10-05 16:45:09" = data$mails[0, ],
            "2016-08-07 15:37:02-2017-05-23 12:31:34" = data$mails[0, ],
            "2016-10-05 16:45:09-2017-05-23 12:32:40" = data$mails[0, ]
        ),
        pasta = list(
            "2013-04-21 23:52:09-2013-05-25 06:22:23" = data$pasta,
            "2013-05-06 01:04:34-2016-07-12 15:30:02" = data$pasta,
            "2013-05-25 06:22:23-2016-07-12 15:59:59" = data$pasta,
            "2016-07-12 15:30:02-2016-07-12 16:02:02" = data$pasta,
            "2016-07-12 15:59:59-2016-07-12 16:06:30" = data$pasta,
            "2016-07-12 16:02:02-2016-07-27 20:12:08" = data$pasta,
            "2016-07-12 16:06:30-2016-08-07 15:37:02" = data$pasta,
            "2016-07-27 20:12:08-2016-10-05 16:45:09" = data$pasta,
            "2016-08-07 15:37:02-2017-05-23 12:31:34" = data$pasta,
            "2016-10-05 16:45:09-2017-05-23 12:32:40" = data$pasta
        ),
        synchronicity = list(
            "2013-04-21 23:52:09-2013-05-25 06:22:23" = data$synchronicity,
            "2013-05-06 01:04:34-2016-07-12 15:30:02" = data$synchronicity,
            "2013-05-25 06:22:23-2016-07-12 15:59:59" = data$synchronicity,
            "2016-07-12 15:30:02-2016-07-12 16:02:02" = data$synchronicity,
            "2016-07-12 15:59:59-2016-07-12 16:06:30" = data$synchronicity,
            "2016-07-12 16:02:02-2016-07-27 20:12:08" = data$synchronicity,
            "2016-07-12 16:06:30-2016-08-07 15:37:02" = data$synchronicity,
            "2016-07-27 20:12:08-2016-10-05 16:45:09" = data$synchronicity,
            "2016-08-07 15:37:02-2017-05-23 12:31:34" = data$synchronicity,
            "2016-10-05 16:45:09-2017-05-23 12:32:40" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges.")

    ##
    ## split by too-large activity amount
    ##

    ## split data
    results = split.data.activity.based(project.data, activity.amount = nrow(data$issues) + 10,
                                        activity.type = "issues", sliding.window = TRUE)

    ## check time ranges
    expected = c(
        "2013-04-21 23:52:09-2017-05-23 12:32:40"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected,
                     info = "Time ranges (too-large activity amount).")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2013-04-21 23:52:09", "2017-05-23 12:32:40")
    expected.config = list(
        split.type = "activity-based",
        split.length = 67,
        split.basis = "issues",
        split.sliding.window = FALSE, # The sliding-window approach does not apply if we only have one range or less
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2013-04-21 23:52:09-2017-05-23 12:32:40" = data$commits
        ),
        commit.messages = list(
            "2013-04-21 23:52:09-2017-05-23 12:32:40" = data$commit.messages
        ),
        issues = list(
            "2013-04-21 23:52:09-2017-05-23 12:32:40" = data$issues
        ),
        mails = list(
            "2013-04-21 23:52:09-2017-05-23 12:32:40" = data$mails[13:16, ] # when pasta is not configured: rownames(data$mails) %in% 14:17
        ),
        pasta = list(
            "2013-04-21 23:52:09-2017-05-23 12:32:40" = data$pasta
        ),
        synchronicity = list(
            "2013-04-21 23:52:09-2017-05-23 12:32:40" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges (too-large activity amount).")
}, patrick::cases(
    "pasta, synchronicity: FALSE" = list(test.pasta = FALSE, test.synchronicity = FALSE),
    "pasta, synchronicity: TRUE" = list(test.pasta = TRUE, test.synchronicity = TRUE)
))

## * * window numbers ------------------------------------------------------

##
## Tests for split.data.activity.based(..., number.windows = ..., activity.type = 'commits')
##

patrick::with_parameters_test_that("Split a data object activity-based (number.windows = ..., activity.type = 'commits').", {

    ## configuration objects
    proj.conf = ProjectConf$new(CF.DATA, CF.SELECTION.PROCESS, CASESTUDY, ARTIFACT)
    proj.conf$update.value("issues.from.source", c("jira", "github"))
    proj.conf$update.value("issues.only.comments", FALSE)
    proj.conf$update.values(list(pasta = test.pasta, synchronicity = test.synchronicity))
    net.conf = NetworkConf$new()

    ## data object
    project.data = ProjectData$new(proj.conf)
    data = list(
        commits = project.data$get.commits.unfiltered(),
        commit.messages = project.data$get.commit.messages(),
        issues = project.data$get.issues(),
        mails = project.data$get.mails(),
        pasta = project.data$get.pasta(),
        synchronicity = project.data$get.synchronicity()
    )

    ## split data
    results = split.data.activity.based(project.data, number.windows = 2,
                                        activity.type = "commits",
                                        sliding.window = test.sliding.window)

    ## check time ranges
    expected = c(
        "2016-07-12 15:58:59-2016-07-12 16:06:20",
        "2016-07-12 16:06:20-2016-07-12 16:06:33"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected,
                     info = "Time ranges (number.windows).")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2016-07-12 15:58:59", "2016-07-12 16:06:20", "2016-07-12 16:06:33")
    expected.config = list(
        split.type = "activity-based",
        split.length = 4,
        split.basis = "commits",
        split.sliding.window = FALSE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:20" = data$commits[1:4, ],
            "2016-07-12 16:06:20-2016-07-12 16:06:33" = data$commits[5:8, ]
        ),
        commit.messages = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:20" = data$commit.messages,
            "2016-07-12 16:06:20-2016-07-12 16:06:33" = data$commit.messages
        ),
        issues = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:20" = data$issues[rownames(data$issues) %in% c(1:3, 12, 21:25, 29:30, 32:34, 54:55), ],
            "2016-07-12 16:06:20-2016-07-12 16:06:33" = data$issues[rownames(data$issues) == 4, ]
        ),
        mails = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:20" = data$mails[15:16, ], # when pasta is not configured: rownames(data$mails) %in% 16:17
            "2016-07-12 16:06:20-2016-07-12 16:06:33" = data$mails[0, ]
        ),
        pasta = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:20" = data$pasta,
            "2016-07-12 16:06:20-2016-07-12 16:06:33" = data$pasta
        ),
        synchronicity = list(
            "2016-07-12 15:58:59-2016-07-12 16:06:20" = data$synchronicity,
            "2016-07-12 16:06:20-2016-07-12 16:06:33" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges (number.windows).")

    ## too large number of windows

    expect_error(
        split.data.activity.based(project.data, activity.type = "commits",
                                  number.windows = nrow(project.data$get.commits.unfiltered()) + 10,
                                  sliding.window = test.sliding.window),
        info = "Error expected (number.windows) (1)."
    )

    expect_error(
        split.data.activity.based(project.data, activity.type = "commits", number.windows = 0,
                                  sliding.window = test.sliding.window),
        info = "Error expected (number.windows) (2)."
    )

}, cases.cross.product(
    patrick::cases(
        ## The sliding window parameter should be ignored.
        "sliding window: FALSE" = list(test.sliding.window = FALSE),
        "sliding window: TRUE" = list(test.sliding.window = TRUE)
    ),
    patrick::cases(
        "pasta, synchronicity: FALSE" = list(test.pasta = FALSE, test.synchronicity = FALSE),
        "pasta, synchronicity: TRUE" = list(test.pasta = TRUE, test.synchronicity = TRUE)
    )
))


##
## Tests for split.data.activity.based(..., number.windows = ..., activity.type = 'mails')
##

patrick::with_parameters_test_that("Split a data object activity-based (number.windows = ..., activity.type = 'mails').", {

    ## configuration objects
    proj.conf = ProjectConf$new(CF.DATA, CF.SELECTION.PROCESS, CASESTUDY, ARTIFACT)
    proj.conf$update.value("issues.from.source", c("jira", "github"))
    proj.conf$update.value("issues.only.comments", FALSE)
    proj.conf$update.values(list(pasta = test.pasta, synchronicity = test.synchronicity))
    net.conf = NetworkConf$new()

    ## data object
    project.data = ProjectData$new(proj.conf)
    data = list(
        commits = project.data$get.commits.unfiltered(),
        commit.messages = project.data$get.commit.messages(),
        issues = project.data$get.issues(),
        mails = project.data$get.mails(),
        pasta = project.data$get.pasta(),
        synchronicity = project.data$get.synchronicity()
    )

    ## split data
    results = split.data.activity.based(project.data, number.windows = 2,
                                        activity.type = "mail",
                                        sliding.window = test.sliding.window)

    ## check time ranges
    expected = c(
        "2004-10-09 18:38:13-2010-07-12 12:05:43",
        "2010-07-12 12:05:43-2016-07-12 16:05:38"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected,
                     info = "Time ranges (number.windows).")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2004-10-09 18:38:13", "2010-07-12 12:05:43", "2016-07-12 16:05:38")
    expected.config = list(
        split.type = "activity-based",
        split.length = 8,
        split.basis = "mails",
        split.sliding.window = FALSE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2004-10-09 18:38:13-2010-07-12 12:05:43" = data$commits[0, ],
            "2010-07-12 12:05:43-2016-07-12 16:05:38" = data$commits[1:2, ]
        ),
        commit.messages = list(
            "2004-10-09 18:38:13-2010-07-12 12:05:43" = data$commit.messages,
            "2010-07-12 12:05:43-2016-07-12 16:05:38" = data$commit.messages
        ),
        issues = list(
            "2004-10-09 18:38:13-2010-07-12 12:05:43" = data$issues[0, ],
            "2010-07-12 12:05:43-2016-07-12 16:05:38" = data$issues[rownames(data$issues) %in% c(1:3, 10:12, 21:24, 27:30, 32:34, 37:49, 54:55), ]
        ),
        mails = list(
            ## comments indicate row names when pasta is not configured
            "2004-10-09 18:38:13-2010-07-12 12:05:43" = data$mails[1:8, ], # rownames(data$mails) %in% 1:8
            "2010-07-12 12:05:43-2016-07-12 16:05:38" = data$mails[9:16, ] # rownasem(data$mails) %in% 9:17
        ),
        pasta = list(
            "2004-10-09 18:38:13-2010-07-12 12:05:43" = data$pasta,
            "2010-07-12 12:05:43-2016-07-12 16:05:38" = data$pasta
        ),
        synchronicity = list(
            "2004-10-09 18:38:13-2010-07-12 12:05:43" = data$synchronicity,
            "2010-07-12 12:05:43-2016-07-12 16:05:38" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges (number.windows).")

    ## too large number of windows

    expect_error(
        split.data.activity.based(project.data, activity.type = "mails",
                                  number.windows = nrow(project.data$get.mails()) + 10,
                                  sliding.window = test.sliding.window),
        info = "Error expected (number.windows) (1)."
    )

    expect_error(
        split.data.activity.based(project.data, activity.type = "mails", number.windows = 0,
                                  sliding.window = test.sliding.window),
        info = "Error expected (number.windows) (2)."
    )

}, cases.cross.product(
    patrick::cases(
        ## The sliding window parameter should be ignored.
        "sliding window: FALSE" = list(test.sliding.window = FALSE),
        "sliding window: TRUE" = list(test.sliding.window = TRUE)
    ),
    patrick::cases(
        "pasta, synchronicity: FALSE" = list(test.pasta = FALSE, test.synchronicity = FALSE),
        "pasta, synchronicity: TRUE" = list(test.pasta = TRUE, test.synchronicity = TRUE)
    )
))


##
## Tests for split.data.activity.based(..., number.windows = ..., activity.type = 'issues')
##

patrick::with_parameters_test_that("Split a data object activity-based (number.windows = ..., activity.type = 'issues').", {

    ## configuration objects
    proj.conf = ProjectConf$new(CF.DATA, CF.SELECTION.PROCESS, CASESTUDY, ARTIFACT)
    proj.conf$update.value("issues.from.source", c("jira", "github"))
    proj.conf$update.value("issues.only.comments", FALSE)
    proj.conf$update.values(list(pasta = test.pasta, synchronicity = test.synchronicity))
    net.conf = NetworkConf$new()

    ## data object
    project.data = ProjectData$new(proj.conf)
    data = list(
        commits = project.data$get.commits.unfiltered(),
        commit.messages = project.data$get.commit.messages(),
        issues = project.data$get.issues(),
        mails = project.data$get.mails(),
        pasta = project.data$get.pasta(),
        synchronicity = project.data$get.synchronicity()
    )

    ## split data
    results = split.data.activity.based(project.data, number.windows = 2,
                                        activity.type = "issues",
                                        sliding.window = test.sliding.window)

    ## check time ranges
    expected = c(
        "2013-04-21 23:52:09-2016-07-12 16:03:59",
        "2016-07-12 16:03:59-2017-05-23 12:32:40"
    )
    lapply(results, function(res) {
        expect_equal(res$get.project.conf()$get.value("ranges"), expected,
                     info = "Time ranges (number.windows).")
    })

    ## This value should not change, so we compare it with the default, which is `c("v1-v2", "v2-v3")`.
    expect_equal(proj.conf$get.value("ranges"), c("v1-v2", "v2-v3"),
                 info = "Splitting must not modify the original ProjectConf.")

    ## test that the config contains the correct splitting information
    revisions = c("2013-04-21 23:52:09", "2016-07-12 16:03:59", "2017-05-23 12:32:40")
    expected.config = list(
        split.type = "activity-based",
        split.length = 24,
        split.basis = "issues",
        split.sliding.window = FALSE,
        split.revisions = revisions,
        split.revisions.dates = get.date.from.string(revisions)
    )
    lapply(results, function(res) {
        actual = lapply(names(expected.config), res$get.project.conf()$get.value)
        names(actual) = names(expected.config)
        expect_equal(expected.config, actual)
    })

    ## check data for all ranges
    expected.data = list(
        commits = list(
            "2013-04-21 23:52:09-2016-07-12 16:03:59" = data$commits[1:2, ],
            "2016-07-12 16:03:59-2017-05-23 12:32:40" = data$commits[3:8, ]
        ),
        commit.messages = list(
            "2013-04-21 23:52:09-2016-07-12 16:03:59" = data$commit.messages,
            "2016-07-12 16:03:59-2017-05-23 12:32:40" = data$commit.messages
        ),
        issues = list(
            "2013-04-21 23:52:09-2016-07-12 16:03:59" = data$issues[rownames(data$issues) %in% c(1:3, 10:11, 21:24, 27:28, 32:34, 37:49, 54:55), ],
            "2016-07-12 16:03:59-2017-05-23 12:32:40" = data$issues[rownames(data$issues) %in% c(4:9, 12:20, 25:26, 29:31, 50:53, 56:59), ]
        ),
        mails = list(
            ## comments indicate row names when pasta is not configured
            "2013-04-21 23:52:09-2016-07-12 16:03:59" = data$mails[13:14, ], # rownames(data$mails) %in% 13:14
            "2016-07-12 16:03:59-2017-05-23 12:32:40" = data$mails[15:16, ]  # rownames(data$maisl) %in% 15:16
        ),
        pasta = list(
            "2013-04-21 23:52:09-2016-07-12 16:03:59" = data$pasta,
            "2016-07-12 16:03:59-2017-05-23 12:32:40" = data$pasta
        ),
        synchronicity = list(
            "2013-04-21 23:52:09-2016-07-12 16:03:59" = data$synchronicity,
            "2016-07-12 16:03:59-2017-05-23 12:32:40" = data$synchronicity
        )
    )
    results.data = list(
        commits = lapply(results, function(cf.data) cf.data$get.commits.unfiltered()),
        commit.messages = lapply(results, function(cf.data) cf.data$get.commit.messages()),
        issues = lapply(results, function(cf.data) cf.data$get.issues()),
        mails = lapply(results, function(cf.data) cf.data$get.mails()),
        pasta = lapply(results, function(cf.data) cf.data$get.pasta()),
        synchronicity = lapply(results, function(cf.data) cf.data$get.synchronicity())
    )

    expected.data = remove.row.names.from.inner.list.of.dfs(expected.data)
    results.data = remove.row.names.from.inner.list.of.dfs(results.data)

    expect_equal(results.data, expected.data, info = "Data for ranges (number.windows).")

    ## too large number of windows

    expect_error(
        split.data.activity.based(project.data, activity.type = "issues",
                                  number.windows = nrow(project.data$get.issues()) + 10,
                                  sliding.window = test.sliding.window),
        info = "Error expected (number.windows) (1)."
    )

    expect_error(
        split.data.activity.based(project.data, activity.type = "issues", number.windows = 0,
                                  sliding.window = test.sliding.window),
        info = "Error expected (number.windows) (2)."
    )

}, cases.cross.product(
    patrick::cases(
        ## The sliding window parameter should be ignored.
        "sliding window: FALSE" = list(test.sliding.window = FALSE),
        "sliding window: TRUE" = list(test.sliding.window = TRUE)
    ),
    patrick::cases(
        "pasta, synchronicity: FALSE" = list(test.pasta = FALSE, test.synchronicity = FALSE),
        "pasta, synchronicity: TRUE" = list(test.pasta = TRUE, test.synchronicity = TRUE)
    )
))
